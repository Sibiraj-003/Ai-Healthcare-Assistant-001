<div class="flex flex-col h-full bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200">
  @if (view() === 'folders') {
    <!-- FOLDER VIEW -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8">
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
          <div>
            <h1 class="text-4xl font-bold text-slate-900 dark:text-white">{{ languageService.translationsMap()['medicalRecords'] }}</h1>
            <p class="mt-2 text-slate-500 dark:text-slate-400">{{ languageService.translationsMap()['selectFolderPrompt'] }}</p>
          </div>
          <div class="flex items-center space-x-3 mt-4 sm:mt-0">
            <button (click)="openModal('createFolder')" class="flex items-center justify-center space-x-2 bg-blue-500 text-white font-semibold px-4 py-2.5 rounded-lg hover:bg-blue-600 transition-colors transform hover:scale-105 active:scale-95">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
              <span>{{ languageService.translationsMap()['createFolder'] }}</span>
            </button>
            <button (click)="openModal('uploadDocument')" [disabled]="folders().length === 0" class="flex items-center justify-center space-x-2 bg-slate-200 text-slate-700 hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600 font-semibold px-4 py-2.5 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H11V9.414l-1.293 1.293a1 1 0 01-1.414-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L13 9.414V13h-2.5z" /><path d="M9 13h2v5a1 1 0 11-2 0v-5z" /></svg>
              <span>{{ languageService.translationsMap()['uploadDocument'] }}</span>
            </button>
          </div>
        </div>
        
        @if (folders().length > 0) {
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            @for (folder of folders(); track folder.id) {
              <div (click)="selectFolder(folder)" class="group relative bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 hover:border-blue-500 dark:hover:border-blue-500 transition-all duration-200 transform hover:-translate-y-1">
                <div class="flex justify-between items-start">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-500 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                  </svg>
                  <div #menuContainer class="relative">
                    <button (click)="toggleMenu(folder.id, $event)" class="p-2 -mr-2 -mt-2 rounded-full text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 hover:text-slate-800 dark:hover:text-white transition-colors">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" /></svg>
                    </button>
                    @if (openMenuId() === folder.id) {
                      <div class="absolute right-0 mt-2 w-40 bg-white dark:bg-slate-700 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-30 animate-scale-in origin-top-right">
                        <div class="py-1">
                          <button (click)="openModal('renameFolder', {id: folder.id, name: folder.name}); $event.stopPropagation()" class="w-full text-left flex items-center px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L16.732 3.732z" /></svg>
                            {{ languageService.translationsMap()['rename'] }}
                          </button>
                          <button (click)="openModal('deleteFolderConfirm', {id: folder.id, name: folder.name}); $event.stopPropagation()" class="w-full text-left flex items-center px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            {{ languageService.translationsMap()['delete'] }}
                          </button>
                        </div>
                      </div>
                    }
                  </div>
                </div>
                <div class="mt-4">
                  <h3 class="font-semibold text-slate-900 dark:text-white truncate">{{ folder.name }}</h3>
                  <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">{{ getDocumentCount(folder.id) }} {{ languageService.translationsMap()['documents'] }}</p>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="text-center py-20 px-4 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl">
            <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-slate-400 dark:text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" /></svg>
            <h3 class="mt-4 text-lg font-semibold text-slate-800 dark:text-slate-200">{{ languageService.translationsMap()['noFolders'] }}</h3>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">{{ languageService.translationsMap()['createFirstFolder'] }}</p>
          </div>
        }
      </div>
    </main>
  } @else if (view() === 'documents' && selectedFolder(); as folder) {
    <!-- DOCUMENT VIEW -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8">
      <div class="max-w-7xl mx-auto">
        <div class="flex items-center mb-8">
          <button (click)="goBackToFolders()" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 mr-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
          </button>
          <h1 class="text-4xl font-bold text-slate-900 dark:text-white truncate">{{ folder.name }}</h1>
          <div class="ml-auto">
            <button (click)="openModal('uploadDocument')" class="flex items-center justify-center space-x-2 bg-blue-500 text-white font-semibold px-4 py-2.5 rounded-lg hover:bg-blue-600 transition-colors transform hover:scale-105 active:scale-95">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H11V9.414l-1.293 1.293a1 1 0 01-1.414-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L13 9.414V13h-2.5z" /><path d="M9 13h2v5a1 1 0 11-2 0v-5z" /></svg>
              <span>{{ languageService.translationsMap()['uploadToFolder'] }}</span>
            </button>
          </div>
        </div>
        
        @if (documentsInSelectedFolder().length > 0) {
          <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl">
            <ul class="divide-y divide-slate-200 dark:divide-slate-700">
              @for (doc of documentsInSelectedFolder(); track doc.id) {
                <li class="flex items-center justify-between p-4 group">
                  <div (click)="openModal('viewDocument', doc)" class="flex items-center space-x-4 min-w-0 cursor-pointer flex-grow">
                    @if (doc.fileType.startsWith('image/')) {
                      <img [src]="getSafeUrl(doc.dataUrl)" alt="thumbnail" class="h-10 w-10 object-cover rounded-md bg-slate-200 dark:bg-slate-700">
                    } @else {
                      <div class="h-10 w-10 flex items-center justify-center rounded-md bg-slate-200 dark:bg-slate-700 shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-500 dark:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                      </div>
                    }
                    <div class="min-w-0">
                      <p class="font-medium text-slate-900 dark:text-white truncate">{{ doc.name }}</p>
                      <p class="text-sm text-slate-500 dark:text-slate-400">{{ doc.createdAt | date:'short' }}</p>
                    </div>
                  </div>
                  <div #menuContainer class="relative shrink-0">
                    <button (click)="toggleMenu(doc.id, $event)" class="p-2 rounded-full text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 hover:text-slate-800 dark:hover:text-white transition-colors">
                       <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" /></svg>
                    </button>
                    @if (openMenuId() === doc.id) {
                      <div class="absolute right-0 mt-2 w-40 bg-white dark:bg-slate-700 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-30 animate-scale-in origin-top-right">
                        <div class="py-1">
                          <button (click)="shareDocument(doc); $event.stopPropagation()" class="w-full text-left flex items-center px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.368a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" /></svg>
                            {{ languageService.translationsMap()['share'] }}
                          </button>
                          <button (click)="openModal('renameDocument', {id: doc.id, name: doc.name}); $event.stopPropagation()" class="w-full text-left flex items-center px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-600">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L16.732 3.732z" /></svg>
                            {{ languageService.translationsMap()['rename'] }}
                          </button>
                          <button (click)="openModal('deleteDocumentConfirm', {id: doc.id, name: doc.name}); $event.stopPropagation()" class="w-full text-left flex items-center px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            {{ languageService.translationsMap()['delete'] }}
                          </button>
                        </div>
                      </div>
                    }
                  </div>
                </li>
              }
            </ul>
          </div>
        } @else {
           <div class="text-center py-20 px-4 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl">
            <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-slate-400 dark:text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
            <h3 class="mt-4 text-lg font-semibold text-slate-800 dark:text-slate-200">{{ languageService.translationsMap()['noDocuments'] }}</h3>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">{{ languageService.translationsMap()['uploadFirstDocument'] }}</p>
          </div>
        }
      </div>
    </main>
  }
</div>

<!-- MODALS -->
@if (activeModal(); as modal) {
  <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in" (click)="closeModal()">
    <!-- Create Folder Modal -->
    @if (modal === 'createFolder') {
      <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-6 w-full max-w-sm mx-4 transform animate-scale-in" (click)="$event.stopPropagation()">
        <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-4">{{ languageService.translationsMap()['createFolder'] }}</h3>
        <input [(ngModel)]="newFolderName" type="text" [placeholder]="languageService.translationsMap()['folderNamePlaceholder']" class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <div class="mt-6 flex justify-end space-x-3">
          <button (click)="closeModal()" class="px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg">{{ languageService.translationsMap()['cancel'] }}</button>
          <button (click)="handleCreateFolder()" [disabled]="!newFolderName()" class="px-4 py-2 text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 rounded-lg disabled:opacity-50">{{ languageService.translationsMap()['create'] }}</button>
        </div>
      </div>
    }
    <!-- Upload Document Modal -->
    @if (modal === 'uploadDocument') {
      <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-6 w-full max-w-md mx-4 transform animate-scale-in" (click)="$event.stopPropagation()">
        <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-4">{{ languageService.translationsMap()['uploadDocument'] }}</h3>
        <div class="space-y-4">
          @if(view() === 'folders') {
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">{{ languageService.translationsMap()['selectFolder'] }}</label>
              <select [(ngModel)]="documentToUpload.folderId" class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="" disabled>{{ languageService.translationsMap()['chooseFolder'] }}</option>
                @for(f of folders(); track f.id) { <option [value]="f.id">{{f.name}}</option> }
              </select>
            </div>
          }
           <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">{{ languageService.translationsMap()['selectFile'] }}</label>
              <input (change)="handleFileSelected($event)" type="file" class="w-full text-sm text-slate-500 dark:text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-slate-200 file:text-slate-700 hover:file:bg-slate-300 dark:file:bg-slate-700 dark:file:text-slate-200 dark:hover:file:bg-slate-600 cursor-pointer"/>
          </div>
        </div>
        <div class="mt-6 flex justify-end space-x-3">
          <button (click)="closeModal()" class="px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg">{{ languageService.translationsMap()['cancel'] }}</button>
          <button (click)="handleUploadDocument()" [disabled]="!documentToUpload.file || (view() === 'folders' && !documentToUpload.folderId)" class="px-4 py-2 text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 rounded-lg disabled:opacity-50">{{ languageService.translationsMap()['upload'] }}</button>
        </div>
      </div>
    }
    <!-- Rename Modals -->
    @if ((modal === 'renameFolder' || modal === 'renameDocument') && itemToRename(); as item) {
      <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-6 w-full max-w-sm mx-4 transform animate-scale-in" (click)="$event.stopPropagation()">
        <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-4">{{ languageService.translationsMap()['rename'] }} {{ item.name }}</h3>
        <input [ngModel]="item.name" (ngModelChange)="itemToRename.set({id: item.id, name: $event})" type="text" class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <div class="mt-6 flex justify-end space-x-3">
          <button (click)="closeModal()" class="px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg">{{ languageService.translationsMap()['cancel'] }}</button>
          <button (click)="handleRename()" [disabled]="!item.name" class="px-4 py-2 text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 rounded-lg disabled:opacity-50">{{ languageService.translationsMap()['save'] }}</button>
        </div>
      </div>
    }
    <!-- Confirmation Modals -->
    @if ((modal === 'deleteFolderConfirm' || modal === 'deleteDocumentConfirm') && itemToDelete(); as item) {
       <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-6 w-full max-w-sm mx-4 transform animate-scale-in" (click)="$event.stopPropagation()">
          <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-2">{{ languageService.translationsMap()['areYouSure'] }}</h3>
          <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">{{ languageService.translationsMap()['confirmDelete'] }} "{{item.name}}"? {{ modal === 'deleteFolderConfirm' ? languageService.translationsMap()['folderDeleteWarning'] : '' }}</p>
          <div class="mt-6 flex justify-end space-x-3">
            <button (click)="closeModal()" class="px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg">{{ languageService.translationsMap()['cancel'] }}</button>
            <button (click)="handleDelete()" class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-500 rounded-lg">{{ languageService.translationsMap()['delete'] }}</button>
          </div>
        </div>
    }
    <!-- Document Viewer Modal -->
    @if (modal === 'viewDocument' && documentToView(); as doc) {
      <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-4 w-full max-w-3xl max-h-[90vh] mx-4 transform animate-scale-in flex flex-col" (click)="$event.stopPropagation()">
        <div class="flex items-center justify-between pb-3 border-b border-slate-200 dark:border-slate-700 shrink-0">
          <h3 class="text-lg font-bold text-slate-900 dark:text-white truncate">{{ doc.name }}</h3>
          <button (click)="closeModal()" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 -mr-2 text-slate-500 dark:text-slate-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
          </button>
        </div>
        <div class="mt-4 flex-1 overflow-auto">
          @if(doc.fileType.startsWith('image/')) {
            <img [src]="getSafeUrl(doc.dataUrl)" [alt]="doc.name" class="max-w-full max-h-full mx-auto object-contain">
          } @else if (doc.fileType === 'application/pdf') {
            <object [data]="getSafeUrl(doc.dataUrl)" type="application/pdf" width="100%" height="100%"><p>PDF viewer not available.</p></object>
          } @else {
            <div class="text-center p-10 text-slate-500 dark:text-slate-400">
              <p>{{ languageService.translationsMap()['previewNotAvailable'] }}</p>
              <a [href]="getSafeUrl(doc.dataUrl)" [download]="doc.name" class="mt-4 inline-block text-blue-500 dark:text-blue-400 hover:underline">Download File</a>
            </div>
          }
        </div>
      </div>
    }
  </div>
}

<!-- Share Fallback Modal -->
@if (isShareFallbackModalOpen() && documentToShare(); as doc) {
  <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in" (click)="closeShareFallbackModal()">
    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-6 w-full max-w-sm mx-4 transform animate-scale-in" (click)="$event.stopPropagation()">
      <div class="flex items-start justify-between mb-4">
        <h3 class="text-lg font-bold text-slate-900 dark:text-white">{{ languageService.translationsMap()['shareFile'] }}</h3>
        <button (click)="closeShareFallbackModal()" class="p-2 -mt-2 -mr-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
      </div>
      <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">
        {{ languageService.translationsMap()['shareFileNotSupported'] }}
      </p>
      <div class="flex flex-col space-y-3">
        <a [href]="getSafeUrl(doc.dataUrl)" [download]="doc.name" (click)="closeShareFallbackModal()" class="w-full text-center px-4 py-2.5 text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors flex items-center justify-center space-x-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
          <span>{{ languageService.translationsMap()['downloadFile'] }}</span>
        </a>
        <button (click)="closeShareFallbackModal()" class="w-full px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg">
          {{ languageService.translationsMap()['close'] }}
        </button>
      </div>
    </div>
  </div>
}--- END OF FILE

